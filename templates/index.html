<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Face Recognition System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <h1 class="text-center mb-4">ðŸ‘¤ Face Recognition Demo</h1>

    <!-- Livestream video -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">Webcam Livestream (Server)</div>
        <div class="card-body text-center">
            <img src="{{ url_for('video_feed') }}" width="640" height="480" class="img-fluid rounded border">
        </div>
    </div>

    <!-- Upload áº£nh -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-success text-white">Upload áº¢nh Ä‘á»ƒ Nháº­n diá»‡n</div>
        <div class="card-body">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" name="file" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">Nháº­n diá»‡n</button>
            </form>
            <div id="uploadResult" class="mt-3 alert d-none"></div>
        </div>
    </div>

    <!-- Chá»¥p áº£nh tá»« Webcam (Client-side) -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-info text-white">Chá»¥p áº£nh tá»« Webcam (Client)</div>
        <div class="card-body text-center">
            <video id="webcamVideo" width="640" height="480" autoplay class="rounded border"></video>
            <br><br>
            <button id="captureBtn" class="btn btn-info">ðŸ“¸ Chá»¥p & Nháº­n diá»‡n</button>
            <div id="webcamResult" class="mt-3 alert d-none"></div>
        </div>
    </div>

    <!-- Validate -->
    <div class="card shadow-sm">
        <div class="card-header bg-warning text-dark">Validation</div>
        <div class="card-body">
            <button id="validateBtn" class="btn btn-warning">Cháº¡y Validation</button>
            <div id="validateResult" class="mt-3 alert d-none"></div>
        </div>
    </div>
</div>

<!-- Bootstrap JS + Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    // Upload áº£nh
    document.getElementById("uploadForm").addEventListener("submit", function(e){
        e.preventDefault();
        let formData = new FormData(this);

        axios.post("/upload", formData).then(res => {
            let resultDiv = document.getElementById("uploadResult");
            resultDiv.className = "mt-3 alert alert-success";
            resultDiv.innerText = "KhuÃ´n máº·t nháº­n diá»‡n: " + res.data.name;
        }).catch(err => {
            let resultDiv = document.getElementById("uploadResult");
            resultDiv.className = "mt-3 alert alert-danger";
            resultDiv.innerText = err.response?.data?.message || "Lá»—i nháº­n diá»‡n!";
        });
    });

    // Webcam (client-side)
    const video = document.getElementById("webcamVideo");
    const captureBtn = document.getElementById("captureBtn");

    // YÃªu cáº§u quyá»n truy cáº­p webcam
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
        video.srcObject = stream;
    }).catch(err => {
        console.error("KhÃ´ng thá»ƒ truy cáº­p webcam:", err);
    });

    captureBtn.addEventListener("click", function(){
        let canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        let imgData = canvas.toDataURL("image/jpeg");
        axios.post("/webcam", { image: imgData }).then(res => {
            let resultDiv = document.getElementById("webcamResult");
            resultDiv.className = "mt-3 alert alert-success";
            resultDiv.innerText = "KhuÃ´n máº·t nháº­n diá»‡n: " + res.data.name;
        }).catch(err => {
            let resultDiv = document.getElementById("webcamResult");
            resultDiv.className = "mt-3 alert alert-danger";
            resultDiv.innerText = err.response?.data?.message || "Lá»—i nháº­n diá»‡n!";
        });
    });
</script>

</body>
</html>
